import{_ as v,c as s,o as a,j as o,e as u,a as m,am as c,an as h,t as l,ao as C,Z as y,a0 as g,F as P,B as V,G as k}from"./chunks/framework.CvQVt9Yw.js";function b(t,e){let d;return function(...f){clearTimeout(d),d=setTimeout(()=>t.apply(this,f),e)}}function I(t=4){const e="0123456789";return Array.from({length:t},()=>e[Math.floor(Math.random()*e.length)]).join("")}function N(t){return/^1[3-9]\d{9}$/.test(t)}function R(t){if(!/^\d{17}[\dXx]$/.test(t))return!1;const d=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],f=["1","0","X","9","8","7","6","5","4","3","2"],r=t.substring(0,17).split("").reduce((n,i,p)=>n+parseInt(i)*d[p],0);return f[r%11]===t[17].toUpperCase()}const w={data(){return{form:{name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},generatedVerificationCode:"",submitted:!1,lastSubmittedForm:{},allRecords:[],isAdmin:!1,currentPage:1,pageSize:5,errors:{},loading:!1}},computed:{paginatedRecords(){const t=(this.currentPage-1)*this.pageSize;return this.allRecords.slice(t,t+this.pageSize)},totalPages(){return Math.ceil(this.allRecords.length/this.pageSize)}},async mounted(){this.generateVerificationCode(),await this.fetchRecords()},methods:{async fetchRecords(){try{const t=await fetch("http://localhost:3004/records");this.allRecords=await t.json()}catch(t){console.error("获取记录失败:",t)}},generateVerificationCode(){this.generatedVerificationCode=I(),this.errors.verificationCode=""},validatePhoneInput:b(function(){this.form.contact&&!N(this.form.contact)?this.errors.contact="手机号格式不正确":this.errors.contact=""},300),validateIDInput:b(function(){this.form.idNumber&&!R(this.form.idNumber)?this.errors.idNumber="身份证号格式不正确":this.errors.idNumber=""},300),validateNameInput(){this.form.name&&this.form.name.length<2?this.errors.name="姓名至少需要2个字符":this.errors.name=""},async handleSubmit(){if(this.validateNameInput(),this.validatePhoneInput(),this.validateIDInput(),this.form.verificationCode!==this.generatedVerificationCode){this.errors.verificationCode="验证码错误",this.generateVerificationCode();return}if(!(this.errors.name||this.errors.contact||this.errors.idNumber)){this.loading=!0;try{const e=await(await fetch("http://localhost:3004/records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();this.lastSubmittedForm=e,this.allRecords.unshift(e),this.submitted=!0}catch(t){console.error("提交失败:",t)}finally{this.loading=!1,this.resetForm()}}},resetForm(){this.form={name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},this.errors={},this.generateVerificationCode()},formatRecord(t){return`姓名: ${t.name}
联系方式: ${t.contact}
身份证号: ${t.idNumber}
意向厂区: ${t.location}
推荐承诺书: ${t.agree?"已同意":"未同意"}`},loginAdmin(){prompt("请输入管理员密码：")==="hy012210yxj"?this.isAdmin=!0:alert("密码错误，请重试！")},logout(){this.isAdmin=!1,this.currentPage=1},async deleteRecord(t){if(confirm("确定要删除这条记录吗？"))try{await fetch(`http://localhost:3004/records/${t}`,{method:"DELETE"}),this.allRecords=this.allRecords.filter(e=>e.id!==t)}catch(e){console.error("删除失败:",e)}}}},S={class:"form-wrapper"},x={key:0,class:"error"},D={key:0,class:"error"},q={key:0,class:"error"},A={key:0,class:"error"},j=["disabled"],F={key:0,class:"submitted-info"},M={key:1,class:"admin-view"},T=["onClick"],B={class:"pagination"},U=["disabled"],_=["disabled"],z={class:"admin-login"};function E(t,e,d,f,r,n){return a(),s("div",S,[o("form",{onSubmit:e[9]||(e[9]=g((...i)=>n.handleSubmit&&n.handleSubmit(...i),["prevent"]))},[o("label",null,[e[14]||(e[14]=m(" 姓名 ")),c(o("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>r.form.name=i),placeholder:"请填写真实姓名",required:"","aria-required":"true","aria-label":"姓名"},null,512),[[h,r.form.name,void 0,{trim:!0}]]),r.errors.name?(a(),s("span",x,l(r.errors.name),1)):u("",!0)]),o("label",null,[e[15]||(e[15]=m(" 联系方式 ")),c(o("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>r.form.contact=i),placeholder:"请填写手机号",required:"",onBlur:e[2]||(e[2]=(...i)=>n.validatePhoneInput&&n.validatePhoneInput(...i)),"aria-required":"true","aria-label":"联系方式"},null,544),[[h,r.form.contact,void 0,{trim:!0}]]),r.errors.contact?(a(),s("span",D,l(r.errors.contact),1)):u("",!0)]),o("label",null,[e[16]||(e[16]=m(" 身份证号 ")),c(o("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>r.form.idNumber=i),placeholder:"请填写身份证号",required:"",onBlur:e[4]||(e[4]=(...i)=>n.validateIDInput&&n.validateIDInput(...i)),"aria-required":"true","aria-label":"身份证号"},null,544),[[h,r.form.idNumber,void 0,{trim:!0}]]),r.errors.idNumber?(a(),s("span",q,l(r.errors.idNumber),1)):u("",!0)]),o("label",null,[e[18]||(e[18]=m(" 意向厂区 ")),c(o("select",{"onUpdate:modelValue":e[5]||(e[5]=i=>r.form.location=i),"aria-label":"意向厂区"},e[17]||(e[17]=[o("option",{value:"广东深圳"},"广东深圳",-1)]),512),[[C,r.form.location]])]),o("label",null,[e[19]||(e[19]=m(" 图形验证码 ")),c(o("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.form.verificationCode=i),placeholder:"请填写",required:"","aria-required":"true","aria-label":"验证码"},null,512),[[h,r.form.verificationCode]]),o("span",{class:"verification",onClick:e[7]||(e[7]=(...i)=>n.generateVerificationCode&&n.generateVerificationCode(...i)),role:"button",tabindex:"0",onKeydown:e[8]||(e[8]=y((...i)=>n.generateVerificationCode&&n.generateVerificationCode(...i),["enter"]))},l(r.generatedVerificationCode),33),r.errors.verificationCode?(a(),s("span",A,l(r.errors.verificationCode),1)):u("",!0)]),o("button",{type:"submit",disabled:r.loading},l(r.loading?"提交中...":"提交"),9,j)],32),r.submitted?(a(),s("div",F,[e[20]||(e[20]=o("h3",null,"您提交的信息",-1)),o("pre",null,l(n.formatRecord(r.lastSubmittedForm)),1)])):u("",!0),r.isAdmin?(a(),s("div",M,[e[21]||(e[21]=o("h3",null,"所有填表记录",-1)),o("button",{onClick:e[10]||(e[10]=(...i)=>n.logout&&n.logout(...i))},"退出管理员"),(a(!0),s(P,null,V(n.paginatedRecords,(i,p)=>(a(),s("div",{key:p,class:"record"},[o("pre",null,l(n.formatRecord(i)),1),o("button",{onClick:K=>n.deleteRecord(i.id)},"删除",8,T)]))),128)),o("div",B,[o("button",{onClick:e[11]||(e[11]=i=>r.currentPage--),disabled:r.currentPage===1},"上一页",8,U),o("span",null,"第 "+l(r.currentPage)+" 页",1),o("button",{onClick:e[12]||(e[12]=i=>r.currentPage++),disabled:r.currentPage>=n.totalPages},"下一页",8,_)])])):u("",!0),o("div",z,[o("a",{href:"#",onClick:e[13]||(e[13]=g((...i)=>n.loginAdmin&&n.loginAdmin(...i),["prevent"])),"aria-label":"管理员登录"},"管理员入口")])])}const O=v(w,[["render",E],["__scopeId","data-v-e794109c"]]),X=JSON.parse('{"title":"","description":"","frontmatter":{"page":true,"head":[["link",{"rel":"canonical","href":"https://b.14ll.com/biao"}],["meta",{"property":"og:title","content":""}]]},"headers":[],"relativePath":"biao.md","filePath":"biao.md"}'),J={name:"biao.md"},G=Object.assign(J,{setup(t){return(e,d)=>(a(),s("div",null,[k(O)]))}});export{X as __pageData,G as default};
